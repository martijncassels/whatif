"use strict";function broadcastService(e){return{send:function(r,t){e.$broadcast(r,t)}}}function Search(e,r){var t={};return{setResults:function(e){t.criteria=e.value.$modelValue,r.send("search",t.criteria)},getResults:function(r,o){if(t.criteria){var s={value:t.criteria};return e({method:"POST",url:"/api/messages/search/"+r+"."+o,data:s,header:{"Content-Type":"application/json"}})}return e.get("/api/messages/"+r+"."+o)},getFrontPage:function(){return e.get("/api/frontpage")}}}function _(e){return e._}function AuthService(e,r,t){var o=null;return{isLoggedIn:function(){return!!o},getUserStatus:function(){return t.get("/status").success(function(e){o=!!e.status}).error(function(e){o=!1})},login:function(r,s){var n=e.defer();return t.post("/login",{username:r,password:s}).success(function(e,r){200===r&&e.status?(o=!0,n.resolve()):(o=!1,n.reject())}).error(function(e){o=!1,n.reject()}),n.promise},logout:function(){var r=e.defer();return t.get("/logout").success(function(e){o=!1,r.resolve()}).error(function(e){o=!1,r.reject()}),r.promise},register:function(r,o,s,n,i,a,c,l,u){var f=e.defer();return t.post("/register",{username:r,password:o,firstname:s,lastname:n,skills:[{name:"1",value:i},{name:"2",value:a},{name:"3",value:c},{name:"4",value:l},{name:"5",value:u}]}).success(function(e,r){200===r&&e.status?f.resolve():f.reject()}).error(function(e){f.reject()}),f.promise}}}function MainCtrl(e,r){var t=this;t.title="Whatif...!",e.$watch(r.isLoggedIn,function(e){t.isLoggedIn=e})}function AppCtrl(e,r,t,o){var s=this;s.currentpage=1,s.limit=10,s.totalmsgs=0,s.totalpages=0,s.formmodel={},s.searchForm={},o.getResults(s.currentpage-1,s.limit).success(function(e){s.messages=e.docs,s.currentpage=e.page,s.totalmsgs=e.total,s.totalpages=e.pages}).error(function(e){console.log(e)}),e.$on("search",function(e){o.getResults(s.currentpage-1,s.limit).success(function(e){s.messages=e.docs,s.currentpage=e.page,s.totalmsgs=e.total,s.totalpages=e.pages,s.searchvalue=e.searchvalue}).error(function(e){console.log(e)})}),e.pageChanged=function(){o.getResults(s.currentpage-1,s.limit).success(function(e){s.messages=e.docs,s.currentpage=e.page,s.totalmsgs=e.total,s.totalpages=e.pages}).error(function(e){console.log(e)})},s.createMessage=function(){s.formData.$valid&&t.post("/api/messages",s.formData).success(function(e){s.formmodel={},s.formData.$setPristine(),s.formData.$setUntouched(),s.messages=e}).error(function(e){console.log("Error: "+e)})},s.deleteMessage=function(e){t.delete("/api/messages/"+e).success(function(e){s.messages=e}).error(function(e){console.log("Error: "+e)})},s.createComment=function(e,r){t.post("/api/comments/"+r,e.form).success(function(r){e.form={},s.messages=r}).error(function(e){console.log("Error: "+e)})},s.deleteComment=function(e){t.delete("/api/comments/"+e).success(function(e){s.messages=e}).error(function(e){console.log("Error: "+e)})}}function SearchCtrl(e,r,t,o,s,n,i){var a=this;e.$watch(i.isLoggedIn,function(e){a.isLoggedIn=e}),a.onSearchClick=function(e){n.setResults(e),a.searchvalue=null},a.logout=function(){i.logout().then(function(){s.path("/login")})}}function loginController(e,r,t){e.login=function(){e.error=!1,e.disabled=!0,t.login(e.loginForm.username,e.loginForm.password).then(function(){r.path("/messages"),e.disabled=!1,e.loginForm={}}).catch(function(){e.error=!0,e.errorMessage="Invalid username and/or password",e.disabled=!1,e.loginForm={}})}}function logoutController(e,r,t){e.logout=function(){t.logout().then(function(){r.path("/login")})}}function registerController(e,r,t){e.register=function(){e.error=!1,e.disabled=!0,t.register(e.registerForm.username,e.registerForm.password,e.registerForm.firstname,e.registerForm.lastname,e.registerForm.skill1,e.registerForm.skill2,e.registerForm.skill3,e.registerForm.skill4,e.registerForm.skill5).then(function(){r.path("/login"),e.disabled=!1,e.registerForm={},e.formData={}}).catch(function(){e.error=!0,e.errorMessage="Something went wrong!",e.disabled=!1,e.registerForm={}})}}function MsgUpdateCtrl(e,r,t){var o=this;r.get("/api/messages/"+t.entity+"/"+t.id).success(function(e){o.message=e}).error(function(e){console.log("Error: "+e)}),o.updateMessage=function(t){r.put("/api/messages/"+t,e.form).success(function(e){o.form=e,o.success="done updating message!"}).error(function(e){o.error="error updating message!",console.log("Error: "+e)})},o.updateComment=function(t){r.put("/api/comments/"+t,e.form).success(function(r){e.form=r,o.success="done updating message!"}).error(function(e){o.error="error updating message!",console.log("Error: "+e)})}}function MsgViewCtrl(e,r,t,o,s){var n=this;n.isLoggedIn=s.isLoggedIn(),r.get("/api/messages/"+t.entity+"/"+t.id).success(function(e){n.message=e}).error(function(e){console.log("Error: "+e)}),n.createComment=function(t,o){t.form.$valid&&r.post("/api/comments/single/"+o,t.form).success(function(r){e.form={},t.form={},n.message=r}).error(function(e){console.log("Error: "+e)})},n.deleteComment=function(e){r.delete("/api/comments/single/"+e).success(function(e){n.message=e}).error(function(e){console.log("Error: "+e)})}}function MsgNewCtrl(e,r,t,o){var s=this;s.formData={},s.createMessage=function(){s.formData.$valid&&r.post("/api/messages",s.formData).success(function(e){s.formData={},s.messages=e,o.path("/messages")}).error(function(e){console.log("Error: "+e)})}}function MsgFrontPageCtrl(e,r,t,o,s,n){var i=this;i.isLoggedIn=s.isLoggedIn(),n.getFrontPage().success(function(e){i.messages=e}).error(function(e){console.log(e)}),e.$on("search",function(e,r){i.messages=r})}function ProfileCtrl(e,r,t){e.isLoggedIn=t.isLoggedIn(),r.get("/api/profiles").success(function(r){e.profiles=r}).error(function(e){console.log("Error: "+e)}),e.createProfile=function(){r.post("/api/profiles",e.formData).success(function(r){e.formData={},e.profiles=r}).error(function(e){console.log("Error: "+e)})},e.deleteProfile=function(t){r.delete("/api/profiles/"+t).success(function(r){e.profiles=r}).error(function(e){console.log("Error: "+e)})}}function PrfViewCtrl(e,r,t,o,s){e.isLoggedIn=s.isLoggedIn(),e.labels=[],e.data=[],r.get("/api/profiles/"+t.id).success(function(r){e.profiles=r,angular.forEach(e.profiles.skills,function(r,t){e.labels.push(r.name),e.data.push(r.value)}),e.series=["values"],e.options={scales:{yAxes:[{ticks:{min:0,max:6,stepSize:1}}]}},e.options2={scale:{ticks:{min:0,max:6,stepSize:1}}}}).error(function(e){console.log("Error: "+e)}),e.deleteProfile=function(t){r.delete("/api/profiles/"+t).success(function(r){e.profiles=r,o.path("/profiles")}).error(function(e){console.log("Error: "+e)})}}function PrfUpdateCtrl(e,r,t){e.isLoggedIn=AuthService.isLoggedIn(),r.get("/api/profiles/"+t.id).success(function(t){t.avatar?(e.genderoption=t.avatar.gender,e.avatarIDoption=t.avatar.avatarID):(e.genderoption="male",e.avatarIDoption=1),e.gender=["male","female"],e.avatarID=[];for(var o=1;o<114;o++)e.avatarID.push(o);e.profile=t,r.get("/api/factories").success(function(r){e.factories=r}).error(function(e){console.log("Error: "+e)})}).error(function(e){console.log("Error: "+e)}),e.updateProfile=function(o){console.log(e.formData4),r({method:"PUT",url:"/api/profiles/"+t.id,data:e.formData4,header:{"Content-Type":"application/json"}}).success(function(r){e.formData4=r,e.success="done updating profile!"}).error(function(r){e.error="error updating profile!",console.log("Error: "+r)})}}function FactoryCtrl(e,r,t){var o=this;r.get("/api/factories").success(function(e){o.factories=e}).error(function(e){console.log("Error: "+e)}),o.deleteFactory=function(e){r.delete("/api/factories/"+e).success(function(e){o.factories=e}).error(function(e){console.log("Error: "+e)})},o.createFactory=function(){o.formData.$valid&&r.post("/api/factories",o.formData).success(function(e){o.formData={},o.data=e}).error(function(e){console.log("Error: "+e)})}}function FacViewCtrl(e,r,t){var o=this;o.totals={},o.totals.skills=[],o.options={},o.options2={},o.series=[],o.data=[],o.labels=[],r.get("/api/factories/"+t.id).success(function(e){o.factory=e;for(var t=0;t<=4;t++)for(var s=0;s<o.factory.members.length;s++)!o.totals.skills[t]&&o.factory.members[s].skills[t]?(o.totals.skills[t]={name:null,value:null},o.totals.skills[t].name=o.factory.members[s].skills[t].name,o.totals.skills[t].value=o.factory.members[s].skills[t].value):o.factory.members[s].skills[t]?o.totals.skills[t].value+=o.factory.members[s].skills[t].value:o.totals.skills[t].value+=0;o.totals.members=o.factory.members.length,angular.forEach(o.totals.skills,function(e,r){o.labels.push(e.name),o.data.push(e.value)}),o.series=["values"],o.options={scales:{yAxes:[{ticks:{min:0,max:10*o.totals.members*.6,stepSize:1}}]}},o.options2={scale:{ticks:{min:0,max:10*o.totals.members*.6,stepSize:1}}},o.best_skill=_.max(o.totals.skills,function(e){return e.value}),o.worst_skill=_.min(o.totals.skills,function(e){return e.value}),console.log(o.worst_skill),o.prodigies={},r.get("/api/profiles/search_skill/"+o.worst_skill.name).success(function(e){o.prodigies=e}).error(function(e){console.log(e)})}).error(function(e){console.log("Error: "+e)}),o.deleteFactory=function(e){r.delete("/api/factories/"+e).success(function(e){o.factory=e}).error(function(e){console.log("Error: "+e)})}}function FacUpdateCtrl(e,r,t){var o=this;r.get("/api/factories/"+t.id).success(function(e){o.data=e}).error(function(e){console.log("Error: "+e)}),o.updateFactory=function(t){r.put("/api/factories/"+t,e.formData8).success(function(e){o.formData8=e,o.success="done updating message!"}).error(function(e){o.error="error updating message!",console.log("Error: "+e)})},o.getMembers=function(e){return r.get("/api/members/"+e).then(function(e){return e.data})},o.pushMember=function(e){var r={_id:e._id,username:e.username};o.data.members.push(r),o.selected=[]},o.removeMember=function(e){o.data.members.splice(e,1),o.selected=[]}}function isObj(){var e;return function(r){for(e in r)if(r.hasOwnProperty(e))return!1;return!0}}function AdminCtrl(e,r,t){var o=this;o.data=[],o.labels=[],o.series=[],o.options={},r.get("/api/admin/msgstats").success(function(e){o.stats=e,angular.forEach(e.msgcreated,function(e,r){o.labels.push(e._id.date),o.data.push(e.count)}),o.series=["count"],o.options={scales:{yAxes:[{ticks:{min:0,max:Math.ceil(1.05*_.max(o.data)),stepSize:Math.round(_.max(o.data)/5)}}]}}}).error(function(e){console.log("Error: "+e)})}function interpolate(e){return function(r){return String(r).replace(/\%VERSION\%/gm,e)}}function highlight(e){return function(r,t){return t&&(r=r.replace(new RegExp("("+t+")","gi"),"<strong>$1</strong>")),e.trustAsHtml(r)}}function appVersion(e){return function(r,t,o){t.text(e)}}function commentForm(){return{restrict:"E",templateUrl:"commentForm"}}function loading(e){return{restrict:"A",link:function(r,t,o){r.isLoading=function(){return e.pendingRequests.length>0},r.$watch(r.isLoading,function(e){e?t.css("display","block"):t.css("display","none")})}}}angular.module("whatif.services",[]).value("version","0.3").factory("broadcastService",broadcastService).service("Search",Search).factory("_",_).factory("AuthService",AuthService),broadcastService.$inject=["$rootScope"],Search.$inject=["$http","broadcastService"],_.$inject=["$window"],AuthService.$inject=["$q","$timeout","$http"],angular.module("whatif.controllers",[]).controller("MainCtrl",MainCtrl).controller("AppCtrl",AppCtrl).controller("SearchCtrl",SearchCtrl),MainCtrl.$inject=["$scope","AuthService"],AppCtrl.$inject=["$scope","$rootScope","$http","Search"],SearchCtrl.$inject=["$scope","$rootScope","$http","$routeParams","$location","Search","AuthService"],angular.module("whatif.Logincontrollers",[]).controller("loginController",loginController).controller("logoutController",logoutController).controller("registerController",registerController),loginController.$inject=["$scope","$location","AuthService"],logoutController.$inject=["$scope","$location","AuthService"],registerController.$inject=["$scope","$location","AuthService"],angular.module("whatif.Messagecontrollers",[]).controller("MsgUpdateCtrl",MsgUpdateCtrl).controller("MsgViewCtrl",MsgViewCtrl).controller("MsgNewCtrl",MsgNewCtrl).controller("MsgFrontPageCtrl",MsgFrontPageCtrl),MsgUpdateCtrl.$inject=["$scope","$http","$routeParams"],MsgViewCtrl.$inject=["$scope","$http","$routeParams","$location","AuthService"],MsgNewCtrl.$inject=["$scope","$http","$routeParams","$location"],MsgFrontPageCtrl.$inject=["$scope","$http","$routeParams","$location","AuthService","Search"],angular.module("whatif.Profilecontrollers",[]).controller("ProfileCtrl",ProfileCtrl).controller("PrfViewCtrl",PrfViewCtrl).controller("PrfUpdateCtrl",PrfUpdateCtrl),ProfileCtrl.$inject=["$scope","$http","AuthService"],PrfViewCtrl.$inject=["$scope","$http","$routeParams","$location","AuthService"],PrfUpdateCtrl.$inject=["$scope","$http","$routeParams"],angular.module("whatif.Factorycontrollers",[]).controller("FactoryCtrl",FactoryCtrl).controller("FacViewCtrl",FacViewCtrl).controller("FacUpdateCtrl",FacUpdateCtrl),FactoryCtrl.$inject=["$scope","$http","$routeParams"],FacViewCtrl.$inject=["$scope","$http","$routeParams","_"],FacUpdateCtrl.$inject=["$scope","$http","$routeParams"],angular.module("whatif.controllers").filter("isObj",isObj).controller("AdminCtrl",AdminCtrl),AdminCtrl.$inject=["$scope","$http","$routeParams"],angular.module("whatif.filters",[]).filter("interpolate",interpolate).filter("highlight",highlight),interpolate.$inject=["version"],highlight.$inject=["$sce"],angular.module("whatif.directives",[]).directive("appVersion",appVersion).directive("commentForm",commentForm).directive("loading",loading),appVersion.$inject=["version"],loading.$inject=["$http"];